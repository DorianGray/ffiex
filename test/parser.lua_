local ffi = require "ffiex.init"
local required
local expath 
if ffi.os == "OSX" then
	expath = {

	}
	required = {
		["mpool.h"] = {"db.h"}, -- pgno_t
		["pcap-bpf.h"] = {"sys/types.h"}, -- u_int
		["pcap-namedb.h"] = {"sys/types.h", "pcap/bpf.h"}, -- u_char, bpf_u_int32
		["tclDecls.h"] = {"tcl.h"}, -- EXTERN, CONST84_RETURN
		["tkDecls.h"] = {"tcl.h"}, -- EXTERN, CONST84_RETURN
		["lber.h"] = {"lber_types.h"},
		["ldif.h"] = {"lber_types.h"},
	}
	ffi.cdef "#define XP_NO_X_HEADERS"
	ffi.cdef "#include <stdio.h>"
elseif ffi.os == "Linux" then
	expath = {
		["xf86drm.h"] = {"/usr/include/drm"}, -- drm.h	
		["xf86drmMode.h"] = {"/usr/include/drm"}, -- drm.h	
	}
	required = {
		["gcrypt-module.h"] = {"gcrypt.h"}, -- gcry_error_code_t		
		["kdb.h"] = {"limits.h"}, -- SHRT_MAX
		["term_entry.h"] = {"stdio.h"}, -- FILE
		["evrpc.h"] = {"sys/queue.h"}, -- TAILQ_ENTRY
		["jpegint.h"] = {"stdio.h", "jpeglib.h"}, -- JMETHOD
		["jpeglib.h"] = {"stdio.h"}, -- FILE
		["lber.h"] = {"stdio.h", "lber_types.h"}, -- FILE, ber_len_t
                ["ldif.h"] = {"stdio.h", "lber_types.h"}, -- FILE, ber_len_t
		["pngconf.h"] = {"zlib.h"}, -- charf, z_stream
	}
	ffi.cdef "#include <sys/types.h>"
end
if required[arg[1]] then
	for _,hdr in ipairs(required[arg[1]]) do
		print('include ' .. hdr .. ' for ' .. arg[1])
		ffi.cdef (("#include <%s>"):format(hdr))
	end
end
if expath[arg[1]] then
	for _,p in ipairs(expath[arg[1]]) do
		print('add path ' .. p .. ' for ' .. arg[1])
		ffi.path(p)
	end
end
ffi.cdef (("#include <%s>"):format(arg[1]))
